# Docker Compose for Doodoori Sandbox
#
# Usage:
#   Build:  docker-compose -f docker/docker-compose.yml build
#   Login:  docker-compose -f docker/docker-compose.yml run --rm sandbox claude /login
#   Run:    docker-compose -f docker/docker-compose.yml up -d
#   Exec:   docker-compose -f docker/docker-compose.yml exec sandbox claude -p "Hello"
#   Down:   docker-compose -f docker/docker-compose.yml down
#
# Note: First run 'claude /login' to authenticate before using sandbox mode.
#       Credentials are stored in the Docker volume 'doodoori-claude-credentials'.

services:
  sandbox:
    build:
      context: ..
      dockerfile: docker/Dockerfile.sandbox
    image: doodoori/sandbox:latest
    container_name: doodoori-sandbox
    volumes:
      # Mount current project directory as workspace
      - ..:/workspace:rw
      # Use Docker volume for Claude credentials (recommended for subscription auth)
      - doodoori-claude-credentials:/home/doodoori/.claude:rw
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - HOME=/home/doodoori
    working_dir: /workspace
    # Use bridge network by default (can be overridden)
    network_mode: bridge
    # Keep container running
    tty: true
    stdin_open: true

  # Isolated sandbox variant (no network access)
  sandbox-isolated:
    build:
      context: ..
      dockerfile: docker/Dockerfile.sandbox
    image: doodoori/sandbox:latest
    container_name: doodoori-sandbox-isolated
    volumes:
      - ..:/workspace:rw
      - doodoori-claude-credentials:/home/doodoori/.claude:rw
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - HOME=/home/doodoori
    working_dir: /workspace
    network_mode: none
    tty: true
    stdin_open: true

# Named volumes
volumes:
  doodoori-claude-credentials:
    name: doodoori-claude-credentials
